<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <!--[if IE]>
    <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'><![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>It Is Actually 42</title>
    <link rel="stylesheet" href="bootstrap.min.css">
    <style>

    body {
        text-align: center;
    }

    h1 {
        font-size: 40px;
    }

    @media (min-width: 768px) {
        .container {
            max-width: 730px;
        }
    }

    #sequence {
        width: 100%;
        box-sizing: border-box;
        -webkit-box-sizing:border-box;
        -moz-box-sizing: border-box;
    }

    .btn.function {
        width: 120px;
        max-size: 49%;

    }

    .btn.other {
        width: 180px;
        max-width: 49%;
    }

    .equation {
        font-size: 20px;
        position: absolute;
        width: auto;
        left: 0;
        right: 0;
    }
    .explanation {
        margin-top: 20px;
    }

    </style>
</head>
<body>
    <div class="container">
        <p class="explanation">
            Why do people keep asking to find the next term in sequences?
            Anyone with real math knowledge knows there are infinite answers.
            So, from now on, the next term for any sequence I see will
            always be the same:
        </p>
        <h1 class="title">It Is Actually 42</h1>


        <p class="btn-group" data-toggle="buttons">
            <label class="btn btn-primary function active">
                <input type="radio" name="function" id="is_sequence" autocomplete="off" checked> Sequence
            </label>
            <label class="btn btn-primary function">
                <input type="radio" name="function" id="is_function" autocomplete="off"> Function
            </label>
        </p>

        <p class="sequences">
            <input id="sequence" disabled="disabled"></textarea>
        </p>

        <p class="btn-group" data-toggle="buttons">
            <label class="btn btn-primary other active">
                <input type="radio" name="other" id="is_42" autocomplete="off" checked> Is actually 42
            </label>
            <label class="btn btn-primary other">
                <input type="radio" name="other" id="is_other" autocomplete="off"> Something else
            </label>
        </p>



        <p id="status">Initializing...</p>

        <hr/>

        <div id="result">

        </div>
    </div>

    <div id="result">

    </div>

    <script src="jquery-2.1.1.min.js"></script>
    <script src="underscore-min.js"></script>
    <script src="bootstrap.min.js"></script>
    <script src="mathjax/MathJax.js">
        MathJax.Hub.Config({
            extensions: ["tex2jax.js"],
            jax: ["input/TeX","output/HTML-CSS"],
            tex2jax: {inlineMath: [["$","$"]]},
            "HTML-CSS": { linebreaks: { automatic: true } },
            SVG: { linebreaks: { automatic: true } }
        });
    </script>

    <script src="solver.js"></script>

    <script>
        var colorize = function () {
            var raw = $('#sequence').val();
            var func = $('#is_function').is(':checked');
            var other = $('#is_other').is(':checked');
            window.location.hash = [encodeURIComponent(raw), func, other].join('/');

            var input = raw.match(/[+-]*\d+/gi).map(Number);
            if (!other)
                input.push(42);
            var answer = solve(input, func);

            var results = $('#result');
            results.html('');
            results.append($('<p>').text('Given:'));
            for(var i=0; i<input.length; i++) {
                results.append($('<p>').text('$S_{' + (i+1)+'}='+input[i]+'$'));
            }

            results.append($('<p>').text('we can define $S_n$:'));
            var equation = '$S_n=';
            var first = true;
            for(var i=answer.length-1; i>=0; i--) {
                if (answer[i].isZero()) continue;

                if (!first || answer[i].isNegative())
                equation += answer[i].isNegative() ? '-' : '+';
                equation += answer[i].abs().toMJString(i>0) + ' ' + (i>0 ? i>1 ? ('n^{' + i + '}') : 'n': '');
                first = false;
            }
            equation += '$';
            results.append($('<p class="equation">').text(equation));

            MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
            $('#status').text('Ready.');
        };

        var colorize2 = _.debounce(colorize, 500);
        var colorize3 = function () {
            $('#status').text('Waiting (use Ctrl+Enter to avoid debouncing)...');
            colorize2();
        };

        var triggerHash = function (first) {
            var hash = window.location.hash;
            if (hash.match(/^#/)) hash = hash.substr(1);
            var args = hash.split('/');
            args[0] = decodeURIComponent(args[0]);
            if (first && !hash) {
                args[0] = args[0] || '1 2 3 4';
            }
            var el0 = $('#sequence');
            var el1 = $('#is_function');
            var el2 = $('#is_other');
            var val1 = (args[1] || 'false') === 'true';
            var val2 = (args[2] || 'false') === 'true';

            if (first || el0.val() != args[0]) {
                el0.val(args[0]);
                if (val1)
                    el1.click()
                if (val2)
                    el2.click();
                colorize();
            }
        };

        $(function () {
            $('#sequence').on('input', colorize3).on('keydown', function (e) {
                if (e.ctrlKey && e.keyCode == 13) {
                    colorize();
                    e.preventDefault();
                }
            }).prop('disabled', false);
            $('#is_function,#is_sequence,#is_42,#is_other').on('change', colorize)
            $(window).on('hashchange', function () {
                triggerHash(false);
            });
            triggerHash(true);
        });
    </script>
    <script>
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-5988212-2']);
        _gaq.push(['_setDomainName', 'none']);
        _gaq.push(['_setAllowLinker', true]);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</body>
</html>
